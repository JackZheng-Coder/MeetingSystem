<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yanzhen.mapper.MeetingInfoMapper" >
  <resultMap id="BaseResultMap" type="com.yanzhen.model.MeetingInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 24 21:59:52 CST 2021.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="subject" property="subject" jdbcType="VARCHAR" />
    <result column="start_time" property="startTime" jdbcType="TIMESTAMP" />
    <result column="end_time" property="endTime" jdbcType="TIMESTAMP" />
    <result column="is_inside" property="isInside" jdbcType="INTEGER" />
    <result column="room_id" property="roomId" jdbcType="INTEGER" />
    <result column="counts" property="counts" jdbcType="INTEGER" />
    <result column="is_pc" property="isPc" jdbcType="INTEGER" />
    <result column="is_projector" property="isProjector" jdbcType="INTEGER" />
    <result column="need" property="need" jdbcType="VARCHAR" />
    <result column="create_by" property="createBy" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 24 21:59:52 CST 2021.
    -->
    id, subject, start_time, end_time, is_inside, room_id, counts, is_pc, is_projector, 
    need, create_by, create_time
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 24 21:59:52 CST 2021.
    -->
    select 
    <include refid="Base_Column_List" />
    from meeting_info
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 24 21:59:52 CST 2021.
    -->
    delete from meeting_info
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.yanzhen.model.MeetingInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 24 21:59:52 CST 2021.
    -->
    insert into meeting_info (id, subject, start_time, 
      end_time, is_inside, room_id, 
      counts, is_pc, is_projector, 
      need, create_by, create_time
      )
    values (#{id,jdbcType=INTEGER}, #{subject,jdbcType=VARCHAR}, #{startTime,jdbcType=TIMESTAMP}, 
      #{endTime,jdbcType=TIMESTAMP}, #{isInside,jdbcType=INTEGER}, #{roomId,jdbcType=INTEGER}, 
      #{counts,jdbcType=INTEGER}, #{isPc,jdbcType=INTEGER}, #{isProjector,jdbcType=INTEGER}, 
      #{need,jdbcType=VARCHAR}, #{createBy,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.yanzhen.model.MeetingInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 24 21:59:52 CST 2021.
    -->
    insert into meeting_info
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="subject != null" >
        subject,
      </if>
      <if test="startTime != null" >
        start_time,
      </if>
      <if test="endTime != null" >
        end_time,
      </if>
      <if test="isInside != null" >
        is_inside,
      </if>
      <if test="roomId != null" >
        room_id,
      </if>
      <if test="counts != null" >
        counts,
      </if>
      <if test="isPc != null" >
        is_pc,
      </if>
      <if test="isProjector != null" >
        is_projector,
      </if>
      <if test="need != null" >
        need,
      </if>
      <if test="createBy != null" >
        create_by,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="subject != null" >
        #{subject,jdbcType=VARCHAR},
      </if>
      <if test="startTime != null" >
        #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="endTime != null" >
        #{endTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isInside != null" >
        #{isInside,jdbcType=INTEGER},
      </if>
      <if test="roomId != null" >
        #{roomId,jdbcType=INTEGER},
      </if>
      <if test="counts != null" >
        #{counts,jdbcType=INTEGER},
      </if>
      <if test="isPc != null" >
        #{isPc,jdbcType=INTEGER},
      </if>
      <if test="isProjector != null" >
        #{isProjector,jdbcType=INTEGER},
      </if>
      <if test="need != null" >
        #{need,jdbcType=VARCHAR},
      </if>
      <if test="createBy != null" >
        #{createBy,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.yanzhen.model.MeetingInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 24 21:59:52 CST 2021.
    -->
    update meeting_info
    <set >
      <if test="subject != null" >
        subject = #{subject,jdbcType=VARCHAR},
      </if>
      <if test="startTime != null" >
        start_time = #{startTime,jdbcType=TIMESTAMP},
      </if>
      <if test="endTime != null" >
        end_time = #{endTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isInside != null" >
        is_inside = #{isInside,jdbcType=INTEGER},
      </if>
      <if test="roomId != null" >
        room_id = #{roomId,jdbcType=INTEGER},
      </if>
      <if test="counts != null" >
        counts = #{counts,jdbcType=INTEGER},
      </if>
      <if test="isPc != null" >
        is_pc = #{isPc,jdbcType=INTEGER},
      </if>
      <if test="isProjector != null" >
        is_projector = #{isProjector,jdbcType=INTEGER},
      </if>
      <if test="need != null" >
        need = #{need,jdbcType=VARCHAR},
      </if>
      <if test="createBy != null" >
        create_by = #{createBy,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.yanzhen.model.MeetingInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 24 21:59:52 CST 2021.
    -->
    update meeting_info
    set subject = #{subject,jdbcType=VARCHAR},
      start_time = #{startTime,jdbcType=TIMESTAMP},
      end_time = #{endTime,jdbcType=TIMESTAMP},
      is_inside = #{isInside,jdbcType=INTEGER},
      room_id = #{roomId,jdbcType=INTEGER},
      counts = #{counts,jdbcType=INTEGER},
      is_pc = #{isPc,jdbcType=INTEGER},
      is_projector = #{isProjector,jdbcType=INTEGER},
      need = #{need,jdbcType=VARCHAR},
      create_by = #{createBy,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update>

  <resultMap id="queryMeetingInfoAllMap" type="com.yanzhen.model.MeetingInfo"
             extends="BaseResultMap">
    <association property="user" javaType="com.yanzhen.model.User">
       <id column="id" property="id"></id>
       <result column="username" property="username"></result>
    </association>
    <association property="meetingRoom" javaType="com.yanzhen.model.MeetingRoom">
    <id column="id" property="id"></id>
    <result column="dname" property="name"></result>
  </association>

  </resultMap>

  <select id="queryMeetingInfoAll" parameterType="com.yanzhen.model.MeetingInfo"
  resultMap="queryMeetingInfoAllMap">
     select info.*,u.username,room.name as dname from meeting_info info
     left join user u on u.id=info.create_by
     left join meeting_room room on room.id =info.room_id
     <where>
        <if test="subject!=null and subject!=''">
           and subject like '%${subject}%'
        </if>
       <if test="counts!=null ">
         and info.counts=#{counts}
       </if>
       <if test="createBy!=null">
          and info.create_by=#{createBy}
       </if>
     </where>
  </select>


  <select id="queryMeeingInfoByMeetIdAndUserId" resultType="int">
    select count(id) from meeting_user
      where meeting_id=#{meetId} and user_id=#{userId}
  </select>


  <select id="getMeeingInfoByRoomIdAndTime" resultType="int" >
    select count(id) from meeting_info where   ((#{startTime}  BETWEEN start_time and  end_time )
     or (#{endTime}  BETWEEN start_time and  end_time )) and room_id=#{roomId}
  </select>

  <resultMap id="queryMeetInfoByUserIdMap" type="com.yanzhen.model.MeetingUser"  >
    <id column="id" property="id"></id>
    <association property="meetingInfo" javaType="com.yanzhen.model.MeetingInfo">
      <id column="id" property="id"></id>
      <result column="subject" property="subject" jdbcType="VARCHAR" />
      <result column="start_time" property="startTime" jdbcType="VARCHAR" />
      <result column="end_time" property="endTime" jdbcType="INTEGER" />
      <result column="create_by" property="createBy" jdbcType="VARCHAR" />
      <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
      <association property="meetingRoom" javaType="com.yanzhen.model.MeetingRoom">
        <id column="id" property="id"></id>
        <result column="rname" property="name"></result>
      </association>
    </association>
  </resultMap>

  <select id="queryMeetInfoByUserId" parameterType="int"
          resultMap="queryMeetInfoByUserIdMap">
    select room.`name`  as rname ,info.* from
    meeting_user u
    LEFT JOIN   meeting_info info   on u.meeting_id=info.id
    LEFT JOIN meeting_room room on room.id=info.room_id
    where u.user_id=#{userId}
</select>

</mapper>